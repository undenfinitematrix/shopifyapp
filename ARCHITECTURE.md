# WhatsApp Widget Architecture

## System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          SHOPIFY ADMIN                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              AeroChat App Admin Interface                     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  WhatsApp Widget Settings Page                          â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  Configuration                                 â”‚   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Phone Number: +1-555-0123                   â”‚   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Message: "Hi, I'm interested..."            â”‚   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Enable Widget: [Toggle]                     â”‚   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  [Save Settings]                               â”‚   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“ (POST /api/whatsapp/settings)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AEROCHAT APP SERVER                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Routes                                                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚  POST/GET /api/whatsapp/settings                    â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  - Validates phone number                           â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  - Saves to database                                â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  - Returns settings                                 â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚  GET /widget.js                                     â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  - Fetches settings from DB                         â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  - Embeds settings in JS                            â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  - Returns dynamic script                           â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  - Caches for 1 hour                                â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Database (SQLite)                                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚  WhatsAppSettings Table                             â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ id (String, Primary Key)                         â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ shop (String, Unique)                            â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ phoneNumber (String)                             â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ message (String)                                 â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ enabled (Boolean)                                â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ createdAt, updatedAt (DateTime)                 â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SHOPIFY THEME (STOREFRONT)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  theme.liquid                                                â”‚  â”‚
â”‚  â”‚  <!-- Before closing </body> -->                             â”‚  â”‚
â”‚  â”‚  <script src="https://app-domain/widget.js?shop=X" />        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Widget Script Execution (JavaScript)                        â”‚  â”‚
â”‚  â”‚  1. Fetch settings from API                                 â”‚  â”‚
â”‚  â”‚  2. Create HTML element                                     â”‚  â”‚
â”‚  â”‚  3. Apply CSS styling                                       â”‚  â”‚
â”‚  â”‚  4. Attach event listeners                                  â”‚  â”‚
â”‚  â”‚  5. Inject into DOM                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Store Homepage                                              â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚  â”‚
â”‚  â”‚                            â”‚ WhatsAppâ”‚ â† Green button         â”‚  â”‚
â”‚  â”‚                            â”‚  ğŸŸ¢     â”‚   (bottom-right)     â”‚  â”‚
â”‚  â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“ (Click)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         WHATSAPP                                    â”‚
â”‚  Opens: https://wa.me/[PHONE]?text=[MESSAGE]                       â”‚
â”‚  â†’ WhatsApp App or Web                                             â”‚
â”‚  â†’ Pre-filled message                                              â”‚
â”‚  â†’ Ready to send                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Diagram

```
ADMIN CONFIGURATION FLOW:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  Admin                 App Admin UI            App Server           Database
    â”‚                      â”‚                       â”‚                    â”‚
    â”‚â”€ Open Settings â”€â”€â”€â”€â”€â†’â”‚ Load current          â”‚                    â”‚
    â”‚                      â”‚ settings              â”‚                    â”‚
    â”‚                      â”‚â”€ GET /api/whatsapp â”€â”€â†’â”‚ Query              â”‚
    â”‚                      â”‚                       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚
    â”‚                      â”‚                       â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚                      â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†  Return settings    â”‚
    â”‚ Display â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†â”€â”€â”¤                       â”‚                    â”‚
    â”‚ current settings      â”‚                       â”‚                    â”‚
    â”‚                       â”‚                       â”‚                    â”‚
    â”‚â”€ Update number â”€â”€â”€â”€â”€â”€â†’â”‚ +1-555-0123           â”‚                    â”‚
    â”‚â”€ Update message â”€â”€â”€â”€â”€â”€â†’â”‚ "Hi there..."         â”‚                    â”‚
    â”‚â”€ Enable widget â”€â”€â”€â”€â”€â”€â”€â†’â”‚ enabled: true         â”‚                    â”‚
    â”‚                        â”‚                       â”‚                    â”‚
    â”‚â”€ Click Save â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ Validate              â”‚                    â”‚
    â”‚                        â”‚â”€ POST /api/whatsapp â”€â†’â”‚ Upsert record     â”‚
    â”‚                        â”‚  {settings}            â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
    â”‚                        â”‚                        â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                        â”‚  Success + settings   â”‚ Return saved      â”‚
    â”‚                        â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†  settings          â”‚
    â”‚ "Settings saved!" â†â”€â”€â†â”€â”€â”¤                       â”‚                    â”‚
    â”‚                        â”‚                       â”‚                    â”‚


STOREFRONT DISPLAY FLOW:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  Customer Browser       Shopify Theme           App Server           Database
       â”‚                      â”‚                      â”‚                    â”‚
       â”‚â”€ Visit store â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ Load theme.liquid    â”‚                    â”‚
       â”‚                       â”‚â”€â”€â”                   â”‚                    â”‚
       â”‚                       â”‚  â””â”€ Execute script   â”‚                    â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€PAGE LOADâ”€â”€â”€â†â”¤   tag               â”‚                    â”‚
       â”‚                       â”‚   (defer loading)    â”‚                    â”‚
       â”‚                       â”‚                      â”‚                    â”‚
       â”‚                       â”‚â”€ GET /widget.js â”€â”€â”€â”€â†’â”‚ Fetch settings     â”‚
       â”‚                       â”‚   ?shop=X             â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
       â”‚                       â”‚                       â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                       â”‚â†â”€ widget.js code â”€â”€â”€â”€â”‚ Return JS with    â”‚
       â”‚                       â”‚   (embedded config)   â”‚ embedded config   â”‚
       â”‚                       â”‚                       â”‚                    â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€ Execute â”€â”€â”€â”€â†â”¤ Run widget script    â”‚                    â”‚
       â”‚      widget JS         â”‚ â€¢ Create HTML        â”‚                    â”‚
       â”‚                       â”‚ â€¢ Apply CSS          â”‚                    â”‚
       â”‚                       â”‚ â€¢ Inject to DOM      â”‚                    â”‚
       â”‚                       â”‚ â€¢ Attach listeners   â”‚                    â”‚
       â”‚                       â”‚                      â”‚                    â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ WhatsApp button      â”‚                    â”‚
       â”‚   ğŸŸ¢ visible!         â”‚ appears (fixed pos)  â”‚                    â”‚
       â”‚                       â”‚                      â”‚                    â”‚
       â”‚â”€ Click button â”€â”€â”€â”€â”€â”€â”€â†’â”‚ Trigger click event  â”‚                    â”‚
       â”‚                       â”‚ Generate link:       â”‚                    â”‚
       â”‚                       â”‚ wa.me/[NUMBER]       â”‚                    â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Redirect to WhatsAppâ”‚                    â”‚
       â”‚   Opens WhatsApp      â”‚                      â”‚                    â”‚
```

## Component Hierarchy

```
App
â”œâ”€ loader (authenticate.admin)
â”œâ”€ error boundary
â””â”€ AppProvider (embedded)
   â””â”€ Navigation Menu
      â”œâ”€ Home (/)
      â”œâ”€ WhatsApp Widget (/app/whatsapp) â† settings page
      â”‚  â””â”€ useEffect (load settings)
      â”‚  â”œâ”€ Form Fields
      â”‚  â”‚  â”œâ”€ TextField (phone number)
      â”‚  â”‚  â”œâ”€ TextField (message)
      â”‚  â”‚  â””â”€ Checkbox (enable)
      â”‚  â”œâ”€ Actions
      â”‚  â”‚  â””â”€ Save Handler
      â”‚  â”‚     â””â”€ POST /api/whatsapp/settings
      â”‚  â””â”€ Preview
      â”‚     â””â”€ Widget visual
      â””â”€ Additional Page

API Routes
â”œâ”€ /api/whatsapp/settings (loader)
â”‚  â””â”€ authenticate.admin
â”‚  â”œâ”€ prisma.whatsAppSettings.findUnique()
â”‚  â””â”€ return settings
â”œâ”€ /api/whatsapp/settings (action)
â”‚  â””â”€ prisma.whatsAppSettings.upsert()
â””â”€ /widget.js (loader)
   â”œâ”€ fetch settings from DB
   â”œâ”€ generate JS with embedded config
   â””â”€ return with caching headers

Database
â””â”€ WhatsAppSettings
   â”œâ”€ id
   â”œâ”€ shop (unique)
   â”œâ”€ phoneNumber
   â”œâ”€ message
   â”œâ”€ enabled
   â”œâ”€ createdAt
   â””â”€ updatedAt
```

## Widget Lifecycle

```
Page Load
   â†“
Script Tag Executes
   â†“
IIFE Wrapper Starts
   â”œâ”€ CONFIG object created
   â””â”€ Functions defined
       â”œâ”€ createWidgetHTML()
       â”œâ”€ initWidget()
       â””â”€ setupEventListeners()
   â†“
Check DOM Ready
   â”œâ”€ If loading â†’ addEventListener('DOMContentLoaded')
   â””â”€ If ready â†’ Execute initWidget()
   â†“
initWidget() executes
   â”œâ”€ Check if enabled & has phone
   â”‚  â””â”€ If not â†’ return
   â”œâ”€ Check if already exists
   â”‚  â””â”€ If exists â†’ return
   â””â”€ Create and inject widget
       â”œâ”€ createWidgetHTML() â†’ div element
       â”œâ”€ Add HTML + CSS
       â”œâ”€ Set WhatsApp link
       â””â”€ document.body.appendChild()
   â†“
Widget Displays
   â”œâ”€ Fixed position: bottom-right
   â”œâ”€ CSS animations active
   â””â”€ Event listeners attached
   â†“
User Interaction
   â”œâ”€ Hover â†’ scale up
   â”œâ”€ Click â†’ redirect to WhatsApp
   â””â”€ Watch observer for DOM changes
       â””â”€ Re-init if widget removed
```

## File Structure

```
aerochat-whatsapp/
â”œâ”€ app/
â”‚  â”œâ”€ routes/
â”‚  â”‚  â”œâ”€ app.jsx                          (MODIFIED - nav link)
â”‚  â”‚  â”œâ”€ app.whatsapp.jsx                 (NEW - settings page)
â”‚  â”‚  â”œâ”€ api.whatsapp.settings.jsx        (NEW - API endpoints)
â”‚  â”‚  â””â”€ widget.js.jsx                    (NEW - widget script)
â”‚  â”œâ”€ db.server.js
â”‚  â”œâ”€ entry.server.jsx
â”‚  â”œâ”€ shopify.server.js
â”‚  â””â”€ root.jsx
â”œâ”€ prisma/
â”‚  â”œâ”€ schema.prisma                       (MODIFIED - WhatsAppSettings)
â”‚  â””â”€ migrations/
â”‚     â””â”€ create_whatsapp_settings/        (NEW - SQL migration)
â”œâ”€ public/
â”‚  â””â”€ whatsapp-widget.js                  (NEW - widget script copy)
â””â”€ ...

extensions/
â””â”€ theme-whatsapp/                        (NEW - theme extension)
   â”œâ”€ shopify.extension.toml
   â”œâ”€ README.md
   â”œâ”€ blocks/
   â”‚  â””â”€ whatsapp-block.liquid
   â””â”€ src/
      â””â”€ index.js

Documentation/
â”œâ”€ IMPLEMENTATION_SUMMARY.md              (NEW)
â”œâ”€ WIDGET_INSTALLATION_GUIDE.md           (NEW)
â””â”€ TESTING_GUIDE.md                       (NEW)
```

---

This architecture ensures:
- âœ… Secure admin-only configuration
- âœ… Fast public widget serving
- âœ… Database persistence
- âœ… Responsive storefront display
- âœ… Easy theme installation
- âœ… Caching for performance
